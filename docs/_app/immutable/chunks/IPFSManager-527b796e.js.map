{"version":3,"mappings":"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","names":[],"sources":["../../../../../../../svelte-component-gateway/src/lib/IFrame.svelte","../../../../../../../svelte-component-gateway/src/lib/srcdoc/bundled.html?raw","../../../../../../../svelte-component-gateway/src/lib/iframeSrc/constants.js","../../../../../../../svelte-component-gateway/src/lib/Gateway.svelte","../../../../../../src/lib/Proxcryptor.svelte","../../../../../../src/lib/IPFSManager.svelte"],"sourcesContent":["<script>\r\n\t// https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/sandbox\r\n\texport let iframe;\r\n\texport let srcdoc;\r\n\texport let rendered;\r\n\r\n\tlet offsetWidth;\r\n\tlet sendWidth;\r\n\r\n\t// synchronize the width of the parent container and the iframe child\r\n\t$: iframe && iframe.addEventListener('load', handleLoad);\r\n\r\n\t// Wait for the iframe to load, then configure \"width sender\"\r\n\tasync function handleLoad() {\r\n\t\tif (!iframe || !offsetWidth) throw new Error('Missing offsetWidth');\r\n\r\n\t\tconst channel = new MessageChannel();\r\n\r\n\t\tchannel.port1.onmessage = (e) => {\r\n\t\t\t// console.log('WIDTH MESSAGE', { e: e.data });\r\n\t\t\t// e.data; // do something with the reply?\r\n\t\t};\r\n\t\tsendWidth = () => {\r\n\t\t\tiframe.contentWindow.postMessage(\r\n\t\t\t\t{ offsetWidth }, // push the details to loadEsModuleComponent({ esModule, props }) in the iframe\r\n\t\t\t\t'*', // there's only 1 contentWindow on the iframe so it' safe to use '*' as origin\r\n\t\t\t\t[channel.port2]\r\n\t\t\t); // enables the iframe to send messages containing prop updates back to the parent\r\n\t\t};\r\n\t}\r\n\r\n\t$: if (offsetWidth && sendWidth) sendWidth();\r\n</script>\r\n\r\n<div class=\"iframe-container\">\r\n\t<div class=\"header\">\r\n\t\t{#if !rendered}\r\n\t\t\tRendering...\r\n\t\t{/if}\r\n\t</div>\r\n\t<div class=\"iframe-inner\">\r\n\t\t<iframe\r\n\t\t\tsandbox=\"allow-scripts\"\r\n\t\t\ttitle=\"Rendered Component\"\r\n\t\t\tbind:this={iframe}\r\n\t\t\t{srcdoc}\r\n\t\t\tbind:offsetWidth\r\n\t\t/>\r\n\t</div>\r\n</div>\r\n\r\n<style>\r\n\t.iframe-container {\r\n\t\tdisplay: flex;\r\n\t\tflex: 1;\r\n\t\theight: 100%;\r\n\t\twidth: 100%;\r\n\t\t-webkit-border-radius: 4px;\r\n\t\t-moz-border-radius: 4px;\r\n\t\tborder-radius: 4px;\r\n\t}\r\n\r\n\t.header {\r\n\t\tfont-weight: 700;\r\n\t\tfont-size: 0.8rem;\r\n\t\ttext-transform: uppercase;\r\n\t\tcolor: rgba(0, 0, 0, 0.7);\r\n\t}\r\n\tiframe {\r\n\t\tdisplay: flex;\r\n\t\tflex: 1;\r\n\t\theight: 100%;\r\n\t\twidth: 100%;\r\n\t\tborder: 0;\r\n\t}\r\n\r\n\t.iframe-inner {\r\n\t\tdisplay: flex;\r\n\t\tflex: 1;\r\n\t\theight: 100%;\r\n\t}\r\n</style>\r\n","export default \"<!DOCTYPE html>\\n<html lang=\\\"en\\\">\\n\\t<head>\\n\\t\\t<meta charset=\\\"utf-8\\\" />\\n\\t\\t<meta name=\\\"viewport\\\" content=\\\"width=device-width,initial-scale=1\\\" />\\n\\t\\t<style>\\n\\t\\t\\t* {\\n\\t\\t\\t\\tmargin: 0;\\n\\t\\t\\t\\tpadding: 0;\\n\\t\\t\\t\\t/*  include padding and the border */\\n\\t\\t\\t\\tbox-sizing: border-box;\\n\\t\\t\\t\\t/* more padding on the inside of your box, but you don't want the box to resize */\\n\\t\\t\\t\\t/* box-sizing: content-box; */\\n\\t\\t\\t}\\n\\n\\t\\t\\tbody {\\n\\t\\t\\t\\tmargin: 0;\\n\\t\\t\\t\\tposition: relative;\\n\\t\\t\\t}\\n\\t\\t</style>\\n\\t\\t<script defer type=\\\"module\\\">\\n\\t\\t\\tvar app=function(){\\\"use strict\\\";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function s(t){return\\\"function\\\"==typeof t}function r(t,e){return t!=t?e==e:t!==e||t&&\\\"object\\\"==typeof t||\\\"function\\\"==typeof t}function c(t,e,n){t.insertBefore(e,n||null)}function i(t){t.parentNode.removeChild(t)}function u(t){return document.createElement(t)}function a(t){return document.createTextNode(t)}function l(){return a(\\\"\\\")}class d{constructor(t=!1){this.is_svg=!1,this.is_svg=t,this.e=this.n=null}c(t){this.h(t)}m(t,e,n=null){var o;this.e||(this.is_svg?this.e=(o=e.nodeName,document.createElementNS(\\\"http://www.w3.org/2000/svg\\\",o)):this.e=u(e.nodeName),this.t=e,this.c(t)),this.i(n)}h(t){this.e.innerHTML=t,this.n=Array.from(this.e.childNodes)}i(t){for(let e=0;e<this.n.length;e+=1)c(this.t,this.n[e],t)}p(t){this.d(),this.h(t),this.i(this.a)}d(){this.n.forEach(i)}}let f;function p(t){f=t}function h(){if(!f)throw new Error(\\\"Function called outside component initialization\\\");return f}function $(){const t=h();return(e,n,{cancelable:o=!1}={})=>{const s=t.$$.callbacks[e];if(s){const r=function(t,e,{bubbles:n=!1,cancelable:o=!1}={}){const s=document.createEvent(\\\"CustomEvent\\\");return s.initCustomEvent(t,n,o,e),s}(e,n,{cancelable:o});return s.slice().forEach((e=>{e.call(t,r)})),!r.defaultPrevented}return!0}}const m=[],g=[],b=[],y=[],v=Promise.resolve();let _=!1;function w(t){b.push(t)}const x=new Set;let E=0;function k(){const t=f;do{for(;E<m.length;){const t=m[E];E++,p(t),M(t.$$)}for(p(null),m.length=0,E=0;g.length;)g.pop()();for(let t=0;t<b.length;t+=1){const e=b[t];x.has(e)||(x.add(e),e())}b.length=0}while(m.length);for(;y.length;)y.pop()();_=!1,x.clear(),p(t)}function M(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(w)}}const L=new Set;let j;function N(t,e){t&&t.i&&(L.delete(t),t.i(e))}function O(t,e,n,o){if(t&&t.o){if(L.has(t))return;L.add(t),j.c.push((()=>{L.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}}function R(t,n,r,c){const{fragment:i,on_mount:u,on_destroy:a,after_update:l}=t.$$;i&&i.m(n,r),c||w((()=>{const n=u.map(e).filter(s);a?a.push(...n):o(n),t.$$.on_mount=[]})),l.forEach(w)}function T(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function P(t,e){-1===t.$$.dirty[0]&&(m.push(t),_||(_=!0,v.then(k)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function U(e,s,r,c,u,a,l,d=[-1]){const h=f;p(e);const $=e.$$={fragment:null,ctx:null,props:a,update:t,not_equal:u,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(s.context||(h?h.$$.context:[])),callbacks:n(),dirty:d,skip_bound:!1,root:s.target||h.$$.root};l&&l($.root);let m=!1;if($.ctx=r?r(e,s.props||{},((t,n,...o)=>{const s=o.length?o[0]:n;return $.ctx&&u($.ctx[t],$.ctx[t]=s)&&(!$.skip_bound&&$.bound[t]&&$.bound[t](s),m&&P(e,t)),n})):[],$.update(),m=!0,o($.before_update),$.fragment=!!c&&c($.ctx),s.target){if(s.hydrate){const t=function(t){return Array.from(t.childNodes)}(s.target);$.fragment&&$.fragment.l(t),t.forEach(i)}else $.fragment&&$.fragment.c();s.intro&&N(e.$$.fragment),R(e,s.target,s.anchor,s.customElement),k()}p(h)}class S{$destroy(){T(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function C(e){let n,o,s,r;return{c(){n=new d(!1),o=l(),s=a(\\\" \\\"),r=u(\\\"div\\\"),n.a=o},m(t,i){n.m(e[0],document.head),function(t,e){t.appendChild(e)}(document.head,o),c(t,s,i),c(t,r,i),e[6](r)},p(t,[e]){1&e&&n.p(t[0])},i:t,o:t,d(t){i(o),t&&n.d(),t&&i(s),t&&i(r),e[6](null)}}}function H(t,e,n){let{esModule:o}=e,{props:s}=e,{css:r}=e;const c=$();let i,u,a,l;function d(t){i&&t&&i.$set({...t})}var f;return f=()=>{n(5,l=!0)},h().$$.on_mount.push(f),function(t){h().$$.on_destroy.push(t)}((()=>{i&&i.$destroy(),u&&URL.revokeObjectURL(u)})),t.$$set=t=>{\\\"esModule\\\"in t&&n(2,o=t.esModule),\\\"props\\\"in t&&n(3,s=t.props),\\\"css\\\"in t&&n(0,r=t.css)},t.$$.update=()=>{36&t.$$.dirty&&l&&o&&async function(){n(0,r=r?`<style>${r}</style>`:\\\"\\\"),i&&(i.$destroy(),URL.revokeObjectURL(u));const t=new Blob([o],{type:\\\"text/javascript\\\"});u=URL.createObjectURL(t);const e=(await import(u)).default;if(!e||!a)return;n(1,a.innerHTML=\\\"\\\",a),n(4,i=new e({target:a,props:{}}));const l=i.$$.props;let f={};Object.keys(l).map((t=>{f[t]=i[t]}));let p=Object.assign(f,s);c(\\\"change\\\",p),i.$on(\\\"change\\\",(t=>{c(\\\"change\\\",t.detail)})),d(p)}(),24&t.$$.dirty&&i&&s&&d()},[r,a,o,s,i,l,function(t){g[t?\\\"unshift\\\":\\\"push\\\"]((()=>{a=t,n(1,a)}))}]}class q extends S{constructor(t){super(),U(this,t,H,C,r,{esModule:2,props:3,css:0})}}function A(t){let e,n;return e=new q({props:{esModule:t[0],props:t[1]}}),e.$on(\\\"change\\\",t[3]),{c(){var t;(t=e.$$.fragment)&&t.c()},m(t,o){R(e,t,o),n=!0},p(t,n){const o={};1&n&&(o.esModule=t[0]),2&n&&(o.props=t[1]),e.$set(o)},i(t){n||(N(e.$$.fragment,t),n=!0)},o(t){O(e.$$.fragment,t),n=!1},d(t){T(e,t)}}}function B(t){let e,n,s,r,u=t[0]&&A(t);return{c(){u&&u.c(),e=l()},m(o,i){var a,l,d,f;u&&u.m(o,i),c(o,e,i),n=!0,s||(a=window,l=\\\"message\\\",d=t[2],a.addEventListener(l,d,f),r=()=>a.removeEventListener(l,d,f),s=!0)},p(t,[n]){t[0]?u?(u.p(t,n),1&n&&N(u,1)):(u=A(t),u.c(),N(u,1),u.m(e.parentNode,e)):u&&(j={r:0,c:[],p:j},O(u,1,1,(()=>{u=null})),j.r||o(j.c),j=j.p)},i(t){n||(N(u),n=!0)},o(t){O(u),n=!1},d(t){u&&u.d(t),t&&i(e),s=!1,r()}}}function X(t,e,n){let o,s,r;return[o,s,async function(t){t?.data&&(t?.data.hasOwnProperty(\\\"load\\\")&&(n(0,({esModule:o,props:s}=t.data.load),o,n(1,s)),r=e=>{t.ports[0].postMessage(e)}),t?.data.hasOwnProperty(\\\"setProps\\\")&&n(1,s=t.data.setProps))},function(t){r&&t.detail&&r(t.detail)}]}globalThis.fetch=()=>(console.log(\\\"Nulled out fetch\\\"),{json:()=>({result:\\\"no fetch, sorry\\\"})}),globalThis.XMLHttpRequest=class{constructor(){console.log(\\\"Nulled out XHR too\\\")}open=()=>null;send=()=>null},globalThis.WebSocket=null,globalThis.EventSource=null;return new class extends S{constructor(t){super(),U(this,t,X,B,r,{})}}({target:document.body,props:{}})}();\\n\\n\\t\\t</script>\\n\\t</head>\\n\\n\\t<body></body>\\n</html>\\n\"","export const CHANGE = 'change';\r\n","<script>\r\n\timport IFrame from './IFrame.svelte';\r\n\timport srcdoc from './srcdoc/bundled.html?raw';\r\n\timport { CHANGE } from './iframeSrc/constants.js';\r\n\timport { createEventDispatcher } from 'svelte';\r\n\r\n\texport let esModule; // TODO: Handle error if not found\r\n\texport let css;\r\n\texport let props; // the consumer of this <Gateway bind:props /> component should bind the props to get updates\r\n\texport let rendered;\r\n\r\n\t// refresh/reload when esModule changes\r\n\t$: if (esModule && iframe) handleLoad();\r\n\r\n\tlet iframe;\r\n\tlet setProps;\r\n\r\n\tconst dispatch = createEventDispatcher();\r\n\r\n\t// this fires when props change; emits an event to update any listeners consuming this compiled component\r\n\t// $: if (props) dispatch(CHANGE, props);\r\n\r\n\t$: iframe && iframe.addEventListener('load', handleLoad);\r\n\r\n\t// Wait for the iframe to load, then configure it\r\n\tasync function handleLoad() {\r\n\t\tif (!esModule || !iframe) throw new Error('Missing esModule');\r\n\r\n\t\tconst channel = new MessageChannel();\r\n\r\n\t\tchannel.port1.onmessage = (e) => {\r\n\t\t\t// props = { ...props, ...e.data }; // update props on any reply from child\r\n\t\t\trendered = true;\r\n\t\t\tdispatch(CHANGE, { ...props, ...e.data }); // this fires when props change; emits an event to update any listeners consuming this compiled component\r\n\r\n\t\t\tsetProps = (props) => {\r\n\t\t\t\tiframe.contentWindow.postMessage(\r\n\t\t\t\t\t{ setProps: props }, // push the details to the iframe\r\n\t\t\t\t\t'*' // there's only 1 contentWindow on the iframe so it' safe to use '*' as origin\r\n\t\t\t\t);\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\tiframe.contentWindow.postMessage(\r\n\t\t\t{ load: { esModule, props, css } }, // push the details to loadEsModuleComponent({ esModule, props }) in the iframe\r\n\t\t\t'*', // there's only 1 contentWindow on the iframe so it' safe to use '*' as origin\r\n\t\t\t[channel.port2]\r\n\t\t); // enables the iframe to send messages containing prop updates back to the parent\r\n\t}\r\n\r\n\t// update props as they change\r\n\t$: if (props && setProps) setProps(props);\r\n</script>\r\n\r\n<IFrame bind:iframe {srcdoc} {rendered} />\r\n","<script lang=\"ts\">\r\n\t// Proxcryptor.svelte\r\n\timport { onMount, createEventDispatcher } from 'svelte';\r\n\timport { validatePubKey } from '$lib/utils/index';\r\n\r\n\texport let rootCID = null;\r\n\texport let proxcryptor;\r\n\texport let ipfsNode; // pass in an instance of ipfs\r\n\r\n\t//  onSubmitted gets bound to, and overwritten by active component\r\n\texport let onSubmitted = () => {}; // optional callback by child component to run after tx submitted\r\n\r\n\tconst dispatch = createEventDispatcher();\r\n\r\n\tlet joseCryptor;\r\n\tlet setJoseCryptor;\r\n\tlet timeoutIDs = new Map();\r\n\tlet loaded;\r\n\r\n\tonMount(async () => {\r\n\t\tconst { DagJoseCryptor } = await import('./dagjosecryptor');\r\n\r\n\t\tsetJoseCryptor = async () => {\r\n\t\t\tjoseCryptor = new DagJoseCryptor(ipfsNode, proxcryptor, rootCID); //refesh when updated\r\n\t\t\tloaded = true;\r\n\t\t};\r\n\t});\r\n\r\n\tlet decrypt = async (tagNode) => await joseCryptor.selfDecrypt(tagNode);\r\n\r\n\tasync function decryptTagNode(tag) {\r\n\t\tif (!rootCID || !ipfsNode || !tag) return;\r\n\r\n\t\ttry {\r\n\t\t\tconst cid = (await ipfsNode.dag.get(rootCID, { path: `/${tag}`, localResolve: true })).value;\r\n\t\t\tlet tagNode = (await ipfsNode.dag.get(cid, { localResolve: true })).value;\r\n\t\t\treturn await decrypt(tagNode);\r\n\t\t} catch (error) {\r\n\t\t\t// tag may not exist yet, or maybe the user is typing\r\n\t\t\tconsole.warn(`${tag} no DAG data`);\r\n\t\t}\r\n\t}\r\n\r\n\t// TODO: Save spinner\r\n\tconst handleTagChange = async function (event) {\r\n\t\t// load contacts in p2p network\r\n\t\tif (!event.detail.tag && event.detail.contacts) dispatch('loadContacts', event.detail.contacts);\r\n\r\n\t\tlet invalid =\r\n\t\t\t!event.detail || !event.detail.tag || (!event.detail.props && !event.detail.targetPublicKey);\r\n\r\n\t\tif (invalid) return; // TODO: Handle missing vals better\r\n\r\n\t\t// does this event add to the access list, or change the property values?\r\n\t\tif (event.detail.hasOwnProperty('targetPublicKey'))\r\n\t\t\tsetAccess(event.detail.tag, event.detail.targetPublicKey);\r\n\t\telse if (event.detail.hasOwnProperty('tag') && event.detail.hasOwnProperty('props'))\r\n\t\t\tputValue({ tag: event.detail.tag, value: event.detail.props });\r\n\r\n\t\t// if tag = Contacts, then pass along to PiperNet for P2P updates\r\n\t\tif (event.detail.tag === 'Contacts') {\r\n\t\t\tdispatch('updateContacts', event.detail.props.props);\r\n\t\t}\r\n\t};\r\n\r\n\tfunction putValue({ tag, value }) {\r\n\t\tif (timeoutIDs.has(tag)) clearTimeout(timeoutIDs.get(tag)); // cancel any exisitng waiting\r\n\r\n\t\ttimeoutIDs.set(\r\n\t\t\ttag,\r\n\t\t\tsetTimeout(async () => {\r\n\t\t\t\ttimeoutIDs.delete(tag);\r\n\r\n\t\t\t\tlet schema = '';\r\n\t\t\t\tconsole.log('Put: ', { tag, value });\r\n\r\n\t\t\t\tawait joseCryptor.put(value, tag, schema);\r\n\t\t\t\tjoseCryptor = joseCryptor; // refresh UI?\r\n\r\n\t\t\t\tonSubmitted(); // update selected component\r\n\t\t\t}, 5000)\r\n\t\t);\r\n\t}\r\n\r\n\t$: if (proxcryptor && setJoseCryptor) setJoseCryptor();\r\n\r\n\t// update the rootCID as req'd\r\n\t$: if (joseCryptor && joseCryptor.rootCID && handleRootCIDUpdate) handleRootCIDUpdate();\r\n\r\n\tfunction handleRootCIDUpdate() {\r\n\t\tdispatch('rootCID', joseCryptor.rootCID);\r\n\t}\r\n\r\n\t// save access function to a svelte store so it can be used by any component, any time\r\n\t// allows access to tag by someone's PublicKey\r\n\tasync function setAccess(tag: string, targetPublicKey: string) {\r\n\t\tconsole.log(`\"Setting access to ${tag} for ${targetPublicKey}\"`);\r\n\t\tconst pubKeyBytes = validatePubKey(targetPublicKey);\r\n\t\tconsole.log({ pubKeyBytes });\r\n\t\tif (!pubKeyBytes) return new Error('Public Key not valid');\r\n\t\t// allow access to this tag by this public key\r\n\t\tawait joseCryptor.setTagReKeys(tag, pubKeyBytes);\r\n\t\tjoseCryptor = joseCryptor; // triggers this.rootCID to fire\r\n\t}\r\n</script>\r\n\r\n{#if joseCryptor}\r\n\t{#if loaded}\r\n\t\t<slot {handleTagChange} {decryptTagNode} />\r\n\t{/if}\r\n{:else}\r\n\tLog into a wallet to encrypt your data/.\r\n{/if}\r\n","<script>\r\n\t/**\r\n\t * Loads, saves, updates, and displays the latest rootCID\r\n\t */\r\n\timport { onMount } from 'svelte';\r\n\timport { CID } from 'multiformats/cid';\r\n\t// import getTagNodes from utils\r\n\timport GetTags from './templates/Contacts/GetTags.svelte';\r\n\timport { Progressbar } from 'flowbite-svelte';\r\n\timport { tweened } from 'svelte/motion';\r\n\timport { cubicOut } from 'svelte/easing';\r\n\t// allows users to pass ina  rootCID as propoerty\r\n\texport let rootCID = null;\r\n\r\n\tlet ipfsNode;\r\n\r\n\tlet tagNodes;\r\n\tlet handleRootCIDUpdate;\r\n\tlet loaded; // let this Component check for saved previous rootCID before loading anything in the slot\r\n\r\n\tconst ROOT_CID = '__ROOT_CID__'; // Database key\r\n\r\n\tlet start = Date.now();\r\n\r\n\t// create tweened value between 0 and 20 seconds\r\n\tconst loader = tweened(1, {\r\n\t\tduration: 45000,\r\n\t\teasing: cubicOut\r\n\t});\r\n\r\n\tasync function loadIPFS() {\r\n\t\t// setup IPFS\r\n\t\tconst IPFSmodule = await import('../modules/ipfs-core-0.14.0/ipfs-core.js');\r\n\t\tconst IPFS = IPFSmodule.default;\r\n\r\n\t\tif (globalThis.ipfsNode) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconsole.log('Creating IPFS node...');\r\n\r\n\t\tipfsNode = await IPFS.create();\r\n\t\tglobalThis.ipfsNode = ipfsNode;\r\n\r\n\t\tconst identity = await globalThis.ipfsNode.id();\r\n\t\tlet nodeId = identity.id;\r\n\r\n\t\tconsole.info('NodeId', nodeId, `Loaded in ${(Date.now() - start) / 1000}s`);\r\n\t}\r\n\r\n\tonMount(async () => {\r\n\t\t$loader = 99;\r\n\t\tawait loadIPFS();\r\n\r\n\t\tconst { ImmortalDB } = await import('immortal-db');\r\n\r\n\t\tif (!rootCID) {\r\n\t\t\tconst res = await ImmortalDB.get(ROOT_CID);\r\n\r\n\t\t\tif (res) {\r\n\t\t\t\trootCID = CID.asCID(res) || CID.parse(res);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\thandleRootCIDUpdate = async () => {\r\n\t\t\tif (!rootCID || !CID.isCID(rootCID)) return;\r\n\t\t\t// refresh the tag nodes\r\n\t\t\tconst root = await ipfsNode.dag.get(rootCID);\r\n\t\t\ttagNodes = root.value;\r\n\t\t\tawait ImmortalDB.set(ROOT_CID, rootCID.toString());\r\n\t\t};\r\n\r\n\t\tloaded = true;\r\n\r\n\t\treturn () => {\r\n\t\t\tglobalThis.ipfsNode.stop();\r\n\t\t\tglobalThis.ipfsNode = null;\r\n\t\t};\r\n\t});\r\n\r\n\t$: if (rootCID && ipfsNode) {\r\n\t\thandleRootCIDUpdate();\r\n\t}\r\n</script>\r\n\r\n<div>\r\n\t{#if rootCID}\r\n\t\t<div class=\"m-2 p-4 bg-slate-200 shadow-sm rounded-lg\">\r\n\t\t\tRootCID: <span class=\"font-mono text-green-700\">\r\n\t\t\t\t{rootCID.toString().substring(0, 8) +\r\n\t\t\t\t\t'..' +\r\n\t\t\t\t\trootCID.toString().substring(rootCID.toString().length - 8, rootCID?.toString().length)}\r\n\t\t\t\t<a href=\"https://dweb.link/api/v0/dag/get?arg={rootCID}\" target=\"_blank\"\r\n\t\t\t\t\t><span class=\"bg-green-600 text-white rounded p-2 mx-4\">DWeb</span></a\r\n\t\t\t\t>\r\n\t\t\t\t|\r\n\t\t\t\t<a href=\"https://explore.ipld.io/#/explore/{rootCID}\" target=\"_blank\"\r\n\t\t\t\t\t><span class=\"bg-green-600 text-white rounded p-2 mr-6\">Explorer</span></a\r\n\t\t\t\t></span\r\n\t\t\t>\r\n\t\t</div>\r\n\t{/if}\r\n\r\n\t<!-- \r\n    <GetTags {rootCID} let:tagNode>\r\n\t\tClick to view: {tagNode.tag}\r\n\t</GetTags> \r\n    -->\r\n\t{#if tagNodes}\r\n\t\t<div class=\"m-2 p-2 border-slate-300 bg-slate-200 shadow-sm rounded-lg\">\r\n\t\t\t<ul>\r\n\t\t\t\t{#each [...Object.entries(tagNodes)] as [tag, cid]}\r\n\t\t\t\t\t<li>\r\n\t\t\t\t\t\t<div class=\"my-1 py-1\">\r\n\t\t\t\t\t\t\t<span class=\"bg-green-600 text-white rounded p-2 mr-6\">{tag}: </span><a\r\n\t\t\t\t\t\t\t\thref=\"https://explore.ipld.io/#/explore/{cid}\"\r\n\t\t\t\t\t\t\t\ttarget=\"_blank\">{cid}</a\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t{/each}\r\n\t\t\t</ul>\r\n\t\t</div>\r\n\t{/if}\r\n</div>\r\n\r\n{#if loaded}\r\n\t<!-- show the selected tag in the slot  -->\r\n\t<slot {tagNodes} {ipfsNode} />\r\n{:else if $loader}\r\n\t<div class=\"p-6\">\r\n\t\t<Progressbar\r\n\t\t\tsize=\"h-6\"\r\n\t\t\tprogress={String($loader.toFixed(0))}\r\n\t\t\tlabelOutside=\"Loading... {$loader.toFixed(0)}%\"\r\n\t\t/>\r\n\t</div>\r\n{/if}\r\n"],"file":"chunks/IPFSManager-527b796e.js"}